# 48.-Izbegaite-lovushek-nadezhnosti

–û—Ç–ª–∏—á–Ω–æ üëç ‚Äî –ü—Ä–∞–≤–∏–ª–æ 48: ‚Äú–ò–∑–±–µ–≥–∞–π—Ç–µ –ª–æ–≤—É—à–µ–∫ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ (soundness traps)‚Äù ‚Äî –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –ø—Ä–∞–∫—Ç–∏—á–Ω—ã—Ö.
TypeScript ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ –Ω–∞–¥—ë–∂–Ω—ã–π (unsound) —è–∑—ã–∫: –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
–≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ JS, –Ω–æ –æ–ø–∞—Å–Ω–æ –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.
–ù–∏–∂–µ ‚Äî –ø—Ä–∏–º–µ—Ä—ã —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö –ª–æ–≤—É—à–µ–∫ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ –∫–∞–∫ –∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ö–æ–¥–∏—Ç—å üëá

## üîπ 1) –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (as)

–ü–ª–æ—Ö–æ:

```ts
const value = "42" as unknown as number; // üí• —Å—Ç—Ä–æ–∫–∞ –ø—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º
console.log(value.toFixed(2)); // runtime error
```

–•–æ—Ä–æ—à–æ:

```ts
function toNumber(v: unknown): number {
  if (typeof v === "number") return v;
  if (typeof v === "string" && !isNaN(+v)) return +v;
  throw new Error("Not a number");
}
```

‚û°Ô∏è –ò–∑–±–µ–≥–∞–π—Ç–µ –¥–≤–æ–π–Ω—ã—Ö as, –¥–µ–ª–∞–π—Ç–µ —è–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

## üîπ 2) any ‚Äî –ø–æ–ª–Ω–æ–µ —Å–Ω—è—Ç–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è

–ü–ª–æ—Ö–æ:

```ts
const user: any = { name: "Serii" };
console.log(user.email.toLowerCase()); // üí• undefined.toLowerCase()
```

–•–æ—Ä–æ—à–æ:

```ts
type User = { name: string; email?: string };
function greet(u: User) {
  console.log(u.email?.toLowerCase() ?? "no email");
}
```

‚û°Ô∏è any ‚Äî –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, –∑–∞–º–µ–Ω—è–π—Ç–µ –Ω–∞ unknown.

## üîπ 3) –ù–∞—Ä—É—à–µ–Ω–∏–µ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–∏ (mutability)

–ü–ª–æ—Ö–æ:

```ts
const arr: readonly number[] = [1, 2, 3];
(arr as number[]).push(4); // üí• –º—É—Ç–∏—Ä—É–µ–º ‚Äúreadonly‚Äù
```

–•–æ—Ä–æ—à–æ:

```ts
const arr = [1, 2, 3] as const; // –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π –∫–æ—Ä—Ç–µ–∂
```

‚û°Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ as –¥–ª—è –æ–±—Ö–æ–¥–∞ readonly.

## üîπ 4) –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ null/undefined

–ü–ª–æ—Ö–æ:

```ts
const name: string | undefined = getName();
console.log(name.toUpperCase()); // üí• –µ—Å–ª–∏ undefined
```

–•–æ—Ä–æ—à–æ:

```ts
if (typeof name === "string") console.log(name.toUpperCase());
else console.warn("Name missing");
```

‚û°Ô∏è –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä ‚Äú—É–≤–µ—Ä–µ–Ω‚Äù.

## üîπ 5) –ò–∑–±—ã—Ç–æ—á–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ union-—Ç–∏–ø–∞—Ö

–ü–ª–æ—Ö–æ:

```ts
type Shape = { kind: "circle"; r: number } | { kind: "square"; size: number };
function area(s: Shape) {
  return Math.PI * (s as any).r ** 2; // üí• square –Ω–µ –∏–º–µ–µ—Ç r
}
```

–•–æ—Ä–æ—à–æ:

```ts
function area(s: Shape) {
  switch (s.kind) {
    case "circle":
      return Math.PI * s.r ** 2;
    case "square":
      return s.size ** 2;
  }
}
```

‚û°Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∏—Ä—É—é—â–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∏ switch –ø–æ –º–µ—Ç–∫–µ.

## üîπ 6) –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–ü–ª–æ—Ö–æ:

```ts
interface Config {
  url: string;
}
const cfg: Config = { url: "test", debug: true } as Config; // üí• –ª–∏—à–Ω–∏–µ –ø–æ–ª—è
```

–•–æ—Ä–æ—à–æ:

```ts
const cfg = { url: "test", debug: true };
useConfig(cfg); // —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑—å–º—ë—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ
```

‚û°Ô∏è –ù–µ –º–∞—Å–∫–∏—Ä—É–π—Ç–µ ¬´–ª–∏—à–Ω–∏–µ¬ª –ø–æ–ª—è –ø–æ–¥ as.

## üîπ 7) –û—à–∏–±–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å generic

–ü–ª–æ—Ö–æ:

```ts
function first<T>(arr: T[]): T {
  return arr[0]; // –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å undefined, –Ω–æ —Ç–∏–ø –Ω–µ –æ—Ç—Ä–∞–∂–∞–µ—Ç
}
const x = first([]).toFixed(2); // üí•
```

–•–æ—Ä–æ—à–æ:

```ts
function first<T>(arr: readonly T[]): T | undefined {
  return arr[0];
}
```

‚û°Ô∏è –î–æ–±–∞–≤–ª—è–π—Ç–µ | undefined, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å.

## üîπ 8) –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–∏

–ü–ª–æ—Ö–æ:

```ts
let n: number = 10;
const s = (n as unknown as string).toUpperCase(); // üí•
```

‚û°Ô∏è –õ—é–±–æ–µ –¥–≤–æ–π–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ (as unknown as) ‚Äî —Å–∏–≥–Ω–∞–ª –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.
–•–æ—Ä–æ—à–æ: –∏–∑–±–µ–≥–∞–π—Ç–µ ¬´—Ç—É–Ω–Ω–µ–ª–µ–π¬ª —á–µ—Ä–µ–∑ unknown.

## üîπ 9) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ (!)

–ü–ª–æ—Ö–æ:

```ts
const el = document.querySelector(".btn")!;
el.addEventListener("click", () => {}); // üí• –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ—Ç
```

–•–æ—Ä–æ—à–æ:

```ts
const el = document.querySelector(".btn");
if (el) el.addEventListener("click", () => {});
```

‚û°Ô∏è ! ‚Äî –æ–ø–∞—Å–µ–Ω, –æ—Å–æ–±–µ–Ω–Ω–æ —Å DOM.

## üîπ 10) –ù–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ

–ü–ª–æ—Ö–æ:

```ts
type User = { id: string; email: string };
const user: User = JSON.parse(localStorage.getItem("u")!); // üí•
```

–•–æ—Ä–æ—à–æ:

```ts
function parseUser(raw: string): User | undefined {
  try {
    const u = JSON.parse(raw);
    if (u && typeof u.id === "string" && typeof u.email === "string") return u;
  } catch {}
  return undefined;
}
```

‚û°Ô∏è –õ—é–±–æ–π –≤–≤–æ–¥ –∏–∑–≤–Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å runtime-–≤–∞–ª–∏–¥–∞—Ü–∏—é.

## üí° –¢–∏–ø–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

- –ò—Å—Ç–æ—á–Ω–∏–∫ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –†–µ—à–µ–Ω–∏–µ
- any –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–º–µ–Ω—è–π—Ç–µ –Ω–∞ unknown
- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ as –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–µ–ª–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏-–≥–∞—Ä–∞–Ω—Ç—ã
- –û–ø–µ—Ä–∞—Ç–æ—Ä ! –º–æ–∂–µ—Ç —Å–∫—Ä—ã—Ç—å null/undefined –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ
- Generic –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ç–µ—Ä—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ extends-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ù–µ–ø–æ–ª–Ω—ã–µ union-–ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –≤–µ—Ç–≤–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ assertNever
- –í–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –Ω–∞ —Ä–∞–Ω—Ç–∞–π–º–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ö–µ–º–æ–π (Zod, io-ts, yup)

## ‚öôÔ∏è –ò—Ç–æ–≥

TypeScript –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∞–¥—ë–∂–µ–Ω, –Ω–æ —ç—Ç–æ –Ω–µ –±–∞–≥ ‚Äî –∞ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –º–µ–∂–¥—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ —É–¥–æ–±—Å—Ç–≤–æ–º.
–ß—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –Ω–∞–¥—ë–∂–Ω–æ:
–∏–∑–±–µ–≥–∞–π—Ç–µ any, as, !, ¬´–¥–≤–æ–π–Ω—ã—Ö¬ª –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–π;
–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∞–Ω—Ç–∞–π–º–µ;
–Ω–µ –ª–æ–º–∞–π—Ç–µ —Ç–∏–ø–æ–≤—É—é –º–æ–¥–µ–ª—å —Ä–∞–¥–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏.
–¢–∞–∫ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ —Å–≤–æ–π TypeScript-–∫–æ–¥ –Ω–∞–¥–µ–∂–Ω—ã–º –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏,
–¥–∞–∂–µ –µ—Å–ª–∏ —Å–∞–º —è–∑—ã–∫ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ ¬´sound¬ª.
